{% extends 'layout.html' %}
{% block breadcrumbs %} Setting Device {% endblock breadcrumbs %}

{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="container mt-3">
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}
<!-- setting ip primary -->
<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-header card-header-text titel-border">
                <h4 class="card-title"><i class="fas fa-wifi"></i> Setting IP Primary</h4>
            </div>
            <!-- select section -->
            <div class="card-content">
                <div class="row mb-3">
                    <label for="site" class="col-sm-4 col-form-label">Site</label>
                    <div class="col-sm-8">
                        <select class="form-control" name="select_ip" id="select_ip">
                            <option value="" disabled selected>Select Site</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12 text-right">
                        <button class="btn btn-primary" id="find-btn">Find</button>
                    </div>
                </div>
            </div>
            <form method="POST">
                <div class="card-content">
                    <input type="hidden" id="site" name="site">
                    <input type="hidden" id="type-ip-address" name="type-ip-address" value="ip-primary">

                    <div class="row mb-3">
                        <label for="ip-address-primary" class="col-sm-4 col-form-label">IP Address Primary</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" name="ip-address-primary" id="ip-address-primary" placeholder="IP Address Primary" value="{{ip_address_primary}}" readonly>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="net-mask" class="col-sm-4 col-form-label">Net Mask</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" name="net-mask" id="net-mask" placeholder="contoh: 24 atau 29" value="{{subnet_mask}}" readonly>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="gateway" class="col-sm-4 col-form-label">Gateway</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" name="gateway" id="gateway" placeholder="Gateway" value="{{gateway}}" readonly>
                        </div>
                    </div>
                    <!-- button -->
                    <div class="row">
                        <div class="col-sm-12 text-right">
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- setting ip secondary -->
<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-header card-header-text titel-border">
                <h4 class="card-title"><i class="fas fa-wifi"></i> Setting IP Secondary</h4>
            </div>
            <form method="POST">
                <div class="card-content">
                    <input type="hidden" id="site" name="site">
                    <input type="hidden" id="type-ip-address" name="type-ip-address" value="ip-secondary">

                    <div class="row mb-3">
                        <label for="ip-address-secondary" class="col-sm-4 col-form-label">IP Address Secondary</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" name="ip-address-secondary" name="ip-address-secondary" placeholder="IP Address Secondary" value="{{ip_address_secondary}}">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="net-mask" class="col-sm-4 col-form-label">Net Mask</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" name="net-mask" id="net-mask" placeholder="contoh: 24 atau 29" value="{{subnet_mask}}">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="gateway" class="col-sm-4 col-form-label">Gateway</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" name="gateway" id="gateway" placeholder="Gateway" value="{{gateway}}">
                        </div>
                    </div>
                    <!-- button -->
                    <div class="row">
                        <div class="col-sm-12 text-right">
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock content %}
{% block js %}
<script>
    // read data site
    const result_data = JSON.parse('{{ data_ip | tojson | safe }}')
    result_data.map((el) => {
        const selectIp = document.getElementById('select_ip')
        const option = document.createElement('option')
        option.value = el.ip
        option.text = el.site
        selectIp.appendChild(option)
    })

    // find ip
    document.getElementById('find-btn').addEventListener('click', function () {
        const selectIp = document.getElementById('select_ip');
        const selectedIp = selectIp.options[selectIp.selectedIndex].value;

        const result = result_data.find(el => el.ip === selectedIp);
        if (result) {
            document.getElementById('ip-address-primary').value = result.ip;
            document.getElementById('net-mask').value = result.subnet_mask;
            document.getElementById('gateway').value = result.gateway;
            document.getElementById('site').value = result.site;
            
            if (result.site === 'IP CUSTOM') {
                // remove attribute readonly
                document.getElementById('ip-address-primary').removeAttribute('readonly');
                document.getElementById('net-mask').removeAttribute('readonly');
                document.getElementById('gateway').removeAttribute('readonly');
                document.getElementById('site').value = {{ site_name|upper}};
            }
        }
    });
</script>
{% endblock js %}
